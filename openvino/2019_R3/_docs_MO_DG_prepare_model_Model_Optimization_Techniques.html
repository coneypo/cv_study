<!DOCTYPE html>
<html lang="en">
<head>
<!-- HTML header for doxygen 1.8.12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Model Optimization Techniques - OpenVINO Toolkit</title>
<script type="text/javascript" src="jquery.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="dynsections.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../assets/versions_raw.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="../assets/openvino-versions.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="openvino-layout.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectalign">
   <div id="projectname"><a href="<domain_placeholder>" class="homelink-id">OpenVINO Toolkit</a></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js?v=e23bd1c8e92f867d90ca8af9d83669a3"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Model Optimization Techniques </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Optimization offers methods to accelerate inference with the convolution neural networks (CNN) that do not require model retraining.</p>
<hr/>
<h2>Linear Operations Fusing</h2>
<p>Many convolution neural networks includes <code>BatchNormalization</code> and <code>ScaleShift</code> layers (for example, Resnet*, Inception*) that can be presented as a sequence of linear operations: additions and multiplications. For example ScaleShift layer can be presented as Mul → Add sequence. These layers can be fused into previous <code>Convolution</code> or <code>FullyConnected</code> layers, except that case when Convolution comes after Add operation (due to Convolution paddings).</p>
<h3>Usage</h3>
<p>In the Model Optimizer, this optimization is turned on by default. To disable it, you can pass <code>--disable_fusing</code> parameter to the Model Optimizer.</p>
<h3>Optimization Description</h3>
<p>This optimization method consists of three stages:</p>
<ol type="1">
<li><b><code>BatchNormalization</code> and <code>ScaleShift</code> decomposition</b>: on this stage, <code>BatchNormalization</code> layer is decomposed to <code>Mul → Add → Mul → Add</code> sequence, and <code>ScaleShift</code> layer is decomposed to <code>Mul → Add</code> layers sequence.</li>
<li><b>Linear operations merge</b>: on this stage we merge sequences of <code>Mul</code> and <code>Add</code> operations to the single <code>Mul → Add</code> instance. For example, if we have <code>BatchNormalization → ScaleShift</code> sequence in our topology, it is replaced with <code>Mul → Add</code> (by the first stage). On the next stage, the latter will be replaced with <code>ScaleShift</code> layer in case if we have no available <code>Convolution</code> or <code>FullyConnected</code> layer to fuse into (next).</li>
<li><b>Linear operations fusion</b>: on this stage, the tool fuses <code>Mul</code> and <code>Add</code> operations to <code>Convolution</code> or <code>FullyConnected</code> layers. Notice that it searches for <code>Convolution</code> and <code>FullyConnected</code> layers both backward and forward in the graph (except for <code>Add</code> operation that cannot be fused to <code>Convolution</code> layer in forward direction).</li>
</ol>
<h3>Usage Examples</h3>
<p>The picture below shows the depicted part of Caffe* Resnet269 topology where <code>BatchNorm</code> and <code>ScaleShift</code> layers will be fused to <code>Convolution</code> layers.</p>
<div class="image">
<img src="resnet_269.png" alt="resnet_269.png"/>
<div class="caption">
Caffe ResNet269 block before and after optimization generated with Netscope*</div></div>
 <hr/>
<h2>ResNet optimization (stride optimization)</h2>
<p>ResNet optimization is a specific optimization that applies to Caffe ResNet topologies such as ResNet50, ResNet101, ResNet152 and to ResNet-based topologies. This optimization is turned on by default, and can be disabled with the <code>--disable_resnet_optimization</code> key.</p>
<h3>Optimization Description</h3>
<p>On the picture below, you can see the original and optimized parts of a Caffe ResNet50 model. The main idea of this optimization is to move the stride that is greater than 1 from Convolution layers with the kernel size = 1 to upper Convolution layers. In addition, the Model Optimizer adds a Pooling layer to align the input shape for a Eltwise layer, if it was changed during the optimization.</p>
<div class="image">
<img src="resnet_optimization.png" alt="resnet_optimization.png"/>
<div class="caption">
ResNet50 blocks (original and optimized) from Netscope*</div></div>
<p> In this example, the stride from the res3a_branch1 and <code>res3a_branch2a</code> Convolution layers moves to the <code>res2c_branch2b</code> Convolution layer. Also to align the input shape for <code>res2c</code> Eltwise, the optimization inserts the Pooling layer with kernel size = 1 and stride = 2.</p>
<hr/>
<h2>Grouped Convolution Fusing</h2>
<p>Grouped convolution fusing is a specific optimization that applies for TensorFlow* topologies. The main idea of this optimization is to combine convolutions results for the <code>Split</code> outputs and then recombine them using <code>Concat</code> operation in the same order as they were out from <code>Split</code>.</p>
<div class="image">
<img src="groups.png" alt="groups.png"/>
<div class="caption">
Split→Convolutions→Concat block from TensorBoard*</div></div>
 <hr/>
<h2>Disable Fusing</h2>
<p>Model Optimizer allows to disable optimizations for specified nodes via <code>--finegrain_fusing &lt;node_name1&gt;,&lt;node_name2&gt;,...</code> (regex is also supported). Using this key, you mark nodes that will noy be touched by any optimizations.</p>
<h3>Examples of usage</h3>
<p>On the picture below you can see two visualized Intermediate Representations (IR) of TensorFlow InceptionV4 topology. The first one is original IR that will be produced by the Model Optimizer. The second one will be produced by the Model Optimizer with key <code>--finegrain_fusing InceptionV4/InceptionV4/Conv2d_1a_3x3/Conv2D</code>, where you can see that <code>Convolution</code> was not fused with <code>Mul1_3752</code> and <code>Mul1_4061/Fused_Mul_5096/FusedScaleShift_5987</code> operations.</p>
<div class="image">
<img src="inception_v4.png" alt="inception_v4.png"/>
<div class="caption">
TF InceptionV4 block without/with key --finegrain_fusing (from IR visualizer)</div></div>
</div></div><!-- contents -->
  <div class="footer">
  <div id="nav-path" class="navpath"></div>
  <div class="footer-content">
    <div class="footer-column">
      <h4>Support</h4>
      <ul>
        <li>
          <a href="https://software.intel.com/en-us/forums/computer-vision">Intel Developer Zone Forum for Intel Distribution of OpenVINO Toolkit</a></li>
      </ul>
    </div>
  </div>
  <div class="copyright">
    <p>Documentation for OpenVINO Toolkit.<br/>
    For more complete information about compiler optimizations, see our <a href="/<version_placeholder>/_docs_IE_DG_Optimization_notice.html">Optimization Notice</a></p>
  </div>
</div>
</body>
</html>