<!DOCTYPE html>
<html lang="en">
<head>
<!-- HTML header for doxygen 1.8.12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Configuration Guide for the Intel® Distribution of OpenVINO™ toolkit 2018R5 and the Intel® Vision Accelerator Design with an Intel® Arria® 10 FPGA (IEI&#39;s Mustang-F100-A10) on Linux* - OpenVINO Toolkit</title>
<script type="text/javascript" src="jquery.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="dynsections.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../assets/versions_raw.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="../assets/openvino-versions.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="openvino-layout.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectalign">
   <div id="projectname"><a href="<domain_placeholder>" class="homelink-id">OpenVINO Toolkit</a></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js?v=e23bd1c8e92f867d90ca8af9d83669a3"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuration Guide for the Intel® Distribution of OpenVINO™ toolkit 2018R5 and the Intel® Vision Accelerator Design with an Intel® Arria® 10 FPGA (IEI's Mustang-F100-A10) on Linux* </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p><b>NOTES:</b></p><ul>
<li>For a first-time installation, use all steps.</li>
<li>Use steps 1 and 2 only after receiving a new FPGA card.</li>
<li>Repeat steps 2-5 when installing a new version of the Intel® Distribution of OpenVINO™ toolkit.</li>
<li>Use steps 3-5 when a Neural Network topology used by an Intel® Distribution of OpenVINO™ toolkit application changes. </li>
</ul>
</blockquote>
<h2>1. Configure and Install the Intel® Vision Accelerator Design with an Intel® Arria® 10 FPGA</h2>
<ol type="1">
<li>Download <code>fpga_support_files.tgz</code> from the <a href="http://registrationcenter-download.intel.com/akdlm/irc_nas/12954/fpga_support_files.tgz">Intel Registration Center</a>. The files in this <code>.tgz</code> archive are required to ensure your FPGA card and the Intel® Distribution of OpenVINO™ toolkit work correctly.</li>
<li>Go to the directory where you downloaded the <code>fpga_support_files.tgz</code> archive.</li>
<li>Unpack the <code>.tgz</code> file: <div class="fragment"><div class="line">tar -xvzf fpga_support_files.tgz</div></div><!-- fragment --> A directory named <code>fpga_support_files</code> is created.</li>
<li>Go to the <code>fpga_support_files</code> directory: <div class="fragment"><div class="line">cd fpga_support_files</div></div><!-- fragment --></li>
<li>Source <code>setup_env.sh</code> to set your environment variables: <div class="fragment"><div class="line">source /home/&lt;user&gt;/Downloads/fpga_support_files/setup_env.sh</div></div><!-- fragment --></li>
<li>Configure the FPGA Driver Blacklist: <div class="fragment"><div class="line">sudo mv config/blacklist-altera-cvp.conf /etc/modprobe.d</div></div><!-- fragment --></li>
<li>Switch to superuser: <div class="fragment"><div class="line">sudo su</div></div><!-- fragment --></li>
<li>Use the <code>setup_env.sh</code> script from <code>fpga_support_files.tgz</code> to set your environment variables: <div class="fragment"><div class="line">source /home/&lt;user&gt;/Downloads/fpga_support_files/setup_env.sh</div></div><!-- fragment --></li>
<li>Change directory to <code>Downloads/fpga_support_files/</code>: <div class="fragment"><div class="line">cd /home/&lt;user&gt;/Downloads/fpga_support_files/</div></div><!-- fragment --></li>
<li>Run the FPGA dependencies script, which allows OpenCL to support Ubuntu* and recent kernels: <div class="fragment"><div class="line">./install_openvino_fpga_dependencies.sh</div></div><!-- fragment --></li>
<li>When asked, select the FPGA card, Intel® GPU, and Intel® Movidius™ Neural Compute Stick, then you can install the correct dependencies.</li>
<li>If you installed the 4.14 kernel as part of the installation script, you will need to reboot the machine and select the new kernel in the Ubuntu (grub) boot menu. You will also need to rerun <code>setup_env.sh</code> to set up your environmental variables again.</li>
<li>Install OpenCL™ devices. Enter <b>Y</b> when prompted to install: <div class="fragment"><div class="line">aocl install</div></div><!-- fragment --></li>
<li>Reboot the machine: <div class="fragment"><div class="line">reboot</div></div><!-- fragment --></li>
<li>Use the <code>setup_env.sh</code> script from <code>fpga_support_files.tgz</code> to set your environment variables: <div class="fragment"><div class="line">source /home/&lt;user&gt;/Downloads/fpga_support_files/setup_env.sh</div></div><!-- fragment --></li>
<li>Run <code>aocl diagnose</code>: <div class="fragment"><div class="line">aocl diagnose</div></div><!-- fragment --> Your screen displays <code>DIAGNOSTIC_PASSED</code>.</li>
</ol>
<h2>2. Set Up the Intel® Vision Accelerator Design with Intel® Arria® 10 FPGA for 2018R5</h2>
<p>For the 2018R5 release, the Intel® Distribution of OpenVINO™ toolkit introduced a new board support package (BSP) <code>a10_1150_sg1</code> for the Intel® Vision Accelerator Design with an Intel® Arria® 10 FPGA, which is included into the <code>fpga_support_files.tgz</code> archive. To program the bitstreams for the Intel® Distribution of OpenVINO™ toolkit R5, you need to program the BSP into the board using the USB blaster.</p>
<blockquote class="doxtable">
<p><b>NOTE</b>: These steps apply only if you update to the Intel® Distribution of OpenVINO™ toolkit R5. Otherwise, you can skip them. </p>
</blockquote>
<ol type="1">
<li>Go to the <code>config</code> folder of the <code>fpga_support_files</code> directory where the <code>a10_1150_sg1</code> is located: <div class="fragment"><div class="line">cd /home/&lt;user&gt;/Downloads/fpga_support_files/config/</div></div><!-- fragment --></li>
<li>Copy the <code>a10_1150_sg1</code> folder to the <code>board</code> directory: <div class="fragment"><div class="line">sudo cp -rf a10_1150_sg1 /opt/altera/aocl-pro-rte/aclrte-linux64/board/</div></div><!-- fragment --></li>
<li>Convert the BSP files from DOS to UNIX: <div class="fragment"><div class="line">sudo chmod +x a10_1150_sg1</div><div class="line">find a10_1150_sg1 -type f -print0 | xargs -0 dos2unix</div></div><!-- fragment --></li>
<li>Set up the USB Blaster:<ol type="a">
<li>Connect the cable between the board and the host system. Use the letter codes in the diagram below for the connection points:</li>
<li>Connect the B end of the cable to point B on the board.</li>
<li>Connect the F end of the cable to point F on the FPGA download cable.</li>
<li>From point F end of the cable to point F on the FPGA download cable, the connection is as shown: <div class="image">
<img src="VisionAcceleratorJTAG.png" alt="VisionAcceleratorJTAG.png"/>
</div>
</li>
</ol>
</li>
<li>Source the <code>setup_env.sh</code> script from the <code>fpga_support_files</code> to set up the environment variables: <div class="fragment"><div class="line">source /home/&lt;user&gt;/Downloads/fpga_support_files/setup_env.sh</div></div><!-- fragment --></li>
<li>Update the Intel® FPGA Download Cable rules to program the board without root permissions and to flash the initialization bitstreams so that the Intel® FPGA Download Cable can communicate with the board: <div class="fragment"><div class="line">sudo cp config/51-usbblaster.rules /etc/udev/rules.d</div></div><!-- fragment --></li>
<li>Load the USB rules: <div class="fragment"><div class="line">sudo udevadm control --reload-rules &amp;&amp; udevadm trigger</div></div><!-- fragment --></li>
<li>Unplug and re-plug the Intel® FPGA Download Cable to enable JTAG connection.</li>
<li>Run <code>jtagconfig</code> to ensure that your Intel FPGA Download Cable driver is ready to use: <div class="fragment"><div class="line">jtagconfig</div></div><!-- fragment --> Your output is similar to: <div class="fragment"><div class="line">1) USB-Blaster [1-6]</div><div class="line">02E660DD   10AX115H1(.|E2|ES)/10AX115H2/.. </div></div><!-- fragment --></li>
<li>Download <a href="http://fpgasoftware.intel.com/17.1/?edition=lite">Intel® Quartus® Prime Software Lite Edition 17.1</a>. Install the Intel® Quartus® Prime Software Lite to the <code>/home/&lt;user&gt;/intelFPGA/17.1</code> directory. <blockquote class="doxtable">
<p><b>NOTE</b>: You will need the complete the Intel® Quartus® Prime Software Lite version when you want to program the <code>boardtest_1ddr_top.aocx</code> into the flash for permanent availability. </p>
</blockquote>
</li>
<li>Export the Intel® Quartus® Prime Software Lite environment variable: <div class="fragment"><div class="line">export QUARTUS_ROOTDIR=/home/&lt;user&gt;/intelFPGA/17.1/quartus</div></div><!-- fragment --></li>
<li>Use <code>jtagconfig</code> to slow the clock: <div class="fragment"><div class="line">jtagconfig --setparam 1 JtagClock 6M</div></div><!-- fragment --></li>
<li>(OPTIONAL) Confirm the clock is set to 6M: <div class="fragment"><div class="line">jtagconfig --getparam 1 JtagClock</div></div><!-- fragment --> You should see the following: <div class="fragment"><div class="line">6M</div></div><!-- fragment --></li>
<li>Go to <code>/opt/altera/aocl-pro-rte/aclrte-linux64/board/a10_1150_sg1/bringup</code>, where <code>boardtest_1ddr_top.aocx</code>is located: <div class="fragment"><div class="line">cd /opt/altera/aocl-pro-rte/aclrte-linux64/board/a10_1150_sg1/bringup</div></div><!-- fragment --></li>
<li>Program the <code>boardtest_1ddr_top.aocx</code> file to the flash to be made permanently available even after power cycle: <div class="fragment"><div class="line">aocl flash acl0 boardtest_1ddr_top.aocx</div></div><!-- fragment --> <blockquote class="doxtable">
<p><b>NOTE</b>: You will need the USB Blaster for this. </p>
</blockquote>
</li>
<li>Reboot the host system.</li>
<li>Check if the host system recognizes the Intel® Vision Accelerator Design with Intel® Arria® 10 FPGA board. Confirm you can detect the PCIe card: <div class="fragment"><div class="line">lspci | grep -i Altera</div></div><!-- fragment --> Your output is similar to: <div class="fragment"><div class="line">01:00.0 Processing accelerators: Altera Corporation Device 2494 (rev 01)</div></div><!-- fragment --></li>
<li>Source the <code>setup_env.sh</code> script from the <code>fpga_support_files</code> directory to setup the environment variables: <div class="fragment"><div class="line">source /home/&lt;user&gt;/Downloads/fpga_support_file/setup_env.sh</div></div><!-- fragment --></li>
<li>Uninstall the previous BSP before installing the OpenCL drivers for the R5 BSP: <div class="fragment"><div class="line">aocl uninstall /opt/altera/aocl-pro-rte/aclrte-linux64/board/&lt;BSP_package&gt;/</div></div><!-- fragment --></li>
<li>Export and source the environment script: <div class="fragment"><div class="line">export AOCL_BOARD_PACKAGE_ROOT=/opt/altera/aocl-pro-rte/aclrte-linux64/board/a10_1150_sg1</div></div><!-- fragment --> <div class="fragment"><div class="line">source /opt/altera/aocl-pro-rte/aclrte-linux64/init_opencl.sh</div></div><!-- fragment --></li>
<li>Install OpenCL™ devices: <div class="fragment"><div class="line">aocl install</div></div><!-- fragment --></li>
<li>Run the <code>diagnose</code> command: <div class="fragment"><div class="line">aocl diagnose</div></div><!-- fragment --> You should see <code>DIAGNOSTIC_PASSED</code> before proceeding to the next steps.</li>
</ol>
<h2>3. Program a Bitstream</h2>
<p>The bitstream you program should correspond to the topology you want to deploy. In this section, you program a SqueezeNet bitstream and deploy the classification sample with a SqueezeNet model that you used the Model Optimizer to convert in the steps before.</p>
<blockquote class="doxtable">
<p><b>IMPORTANT</b>: Only use bitstreams from the installed version of the Intel® Distribution of OpenVINO™ toolkit. Bitstreams from older versions of the Intel® Distribution of OpenVINO™ toolkit are incompatible with later versions of the Intel® Distribution of OpenVINO™ toolkit. For example, you cannot use the <code>1-0-1_A10DK_FP16_Generic</code> bitstream, when the Intel® Distribution of OpenVINO™ toolkit supports the <code>2-0-1_A10DK_FP16_Generic</code> bitstream. </p>
</blockquote>
<p>Depending on how many bitstreams you selected, there are different folders for each FPGA card type which were downloaded in the Intel® Distribution of OpenVINO™ toolkit package:</p>
<ol type="1">
<li>For the Intel® Vision Accelerator Design with Intel® Arria® 10 FPGA the pre-trained bistreams are in <code>/opt/intel/openvino/bitstreams/a10_vision_design_bitstreams</code>. This example uses a SqueezeNet bitstream with low precision for the classification sample.</li>
<li>Rerun the environment setup script: <div class="fragment"><div class="line">source /home/&lt;user&gt;/Downloads/fpga_support_files/setup_env.sh</div></div><!-- fragment --></li>
<li>Change to your home directory: <div class="fragment"><div class="line">cd /home/&lt;user&gt;</div></div><!-- fragment --></li>
<li>Program the bitstream for the Intel® Vision Accelerator Design with Intel® Arria® 10 FPGA: <div class="fragment"><div class="line">aocl program acl0 /opt/intel/openvino/bitstreams/a10_vision_design_bitstreams/5-0_PL1_FP11_SqueezeNet.aocx</div></div><!-- fragment --></li>
</ol>
<h3>Optional Steps to Flash the FPGA Card</h3>
<blockquote class="doxtable">
<p><b>NOTE</b>:</p><ul>
<li>To avoid having to reprogram the board after a power down, a bitstream will be programmed to permanent memory on the Intel® Vision Accelerator Design with Intel® Arria® 10 FPGA. This will take about 20 minutes.</li>
<li>The following steps 1-5 need to be done only once for a new Intel® Arria 10 FPGA card. </li>
</ul>
</blockquote>
<ol type="1">
<li>Plug in the micro USB cable to the card and your host system.</li>
<li>Run <code>jtagconfig</code> to ensure that the cable is properly inserted: <div class="fragment"><div class="line">jtagconfig</div></div><!-- fragment --></li>
<li>Use <code>jtagconfig</code> to slow the clock: <div class="fragment"><div class="line">jtagconfig --setparam 1 JtagClock 6M</div></div><!-- fragment --></li>
<li>Store the Intel® Vision Accelerator Design with Intel® Arria® 10 FPGA bistream on the board: <div class="fragment"><div class="line">aocl flash acl0 /opt/intel/openvino/bitstreams/a10_vision_design_bitstreams/5-0_PL1_FP11_SqueezeNet.aocx</div></div><!-- fragment --> Your output is similar to: <div class="fragment"><div class="line">USB-BlasterII [1-14]</div><div class="line">02E660DD 10AX115H1(.|E2|ES)/10AX115H2/..</div><div class="line">020A40DD 5M(1270ZF324|2210Z)/EPM2210</div></div><!-- fragment --></li>
</ol>
<h2>4. Setup a Neural Network Model for FPGA</h2>
<p>In this section, you will create an FP16 model suitable for hardware accelerators. For more information, see the <a href="https://docs.openvinotoolkit.org/latest/_docs_IE_DG_supported_plugins_FPGA.html">FPGA plugin</a> section in the Inference Engine Developer Guide.</p>
<ol type="1">
<li>Create a directory for the FP16 SqueezeNet Model: <div class="fragment"><div class="line">mkdir /home/&lt;user&gt;/squeezenet1.1_FP16</div></div><!-- fragment --></li>
<li>Go to <code>/home/&lt;user&gt;/squeezenet1.1_FP16</code>: <div class="fragment"><div class="line">cd /home/&lt;user&gt;/squeezenet1.1_FP16</div></div><!-- fragment --></li>
<li>Use the Model Optimizer to convert an FP16 SqueezeNet Caffe* model into an optimized Intermediate Representation (IR): <div class="fragment"><div class="line">python3 /opt/intel/openvino/deployment_tools/model_optimizer/mo.py --input_model /home/&lt;user&gt;/openvino_models/FP32/classification/squeezenet/1.1/caffe/squeezenet1.1.caffemodel --data_type FP16 --output_dir .</div></div><!-- fragment --></li>
<li>The <code>squeezenet1.1.labels</code> file contains the classes <code>ImageNet</code> uses. This file is included so that the inference results show text instead of classification numbers. Copy <code>squeezenet1.1.labels</code> to the your optimized model location: <div class="fragment"><div class="line">cp /home/&lt;user&gt;/openvino_models/ir/squeezenet1.1/FP32/squeezenet1.1.labels  .</div></div><!-- fragment --></li>
<li>Copy a sample image to the release directory. You will use this with your optimized model: <div class="fragment"><div class="line">sudo cp /opt/intel/openvino/deployment_tools/demo/car.png  ~/inference_engine_samples/intel64/Release</div></div><!-- fragment --></li>
</ol>
<h2>5. Run a Sample Application</h2>
<ol type="1">
<li>Go to the samples directory <div class="fragment"><div class="line">cd /home/&lt;user&gt;/inference_engine_samples/intel64/Release</div></div><!-- fragment --></li>
<li>Use an Inference Engine sample to run a sample application on the CPU: <div class="fragment"><div class="line">./classification_sample_async -i car.png -m ~/openvino_models/ir/squeezenet1.1/FP32/squeezenet1.1.xml</div></div><!-- fragment --> Note the CPU throughput in Frames Per Second (FPS). This tells you how quickly the inference is done on the hardware. Now run the inference using the FPGA.</li>
<li>Add the <code>-d</code> option to target the FPGA: <div class="fragment"><div class="line">./classification_sample_async -i car.png -m ~/squeezenet1.1_FP16/squeezenet1.1.xml -d HETERO:FPGA,CPU</div></div><!-- fragment --> The throughput on FPGA is listed and may show a lower FPS. This is due to the initialization time. To account for that, the next step increases the iterations to get a better sense of the speed the FPGA can run inference at.</li>
<li>Use <code>-ni</code> to increase the number of iterations, This option reduces the initialization impact: <div class="fragment"><div class="line">./classification_sample_async -i car.png -m ~/squeezenet1.1_FP16/squeezenet1.1.xml -d HETERO:FPGA,CPU -ni 100</div></div><!-- fragment --></li>
</ol>
<p>Congratulations, you are done with the Intel® Distribution of OpenVINO™ toolkit installation for FPGA. To learn more about how the Intel® Distribution of OpenVINO™ toolkit works, the Hello World tutorial and are other resources are provided below.</p>
<h2>Hello World Face Detection Tutorial</h2>
<p>Use the <a href="https://github.com/fritzboyle/openvino-with-fpga-hello-world-face-detection">Intel® Distribution of OpenVINO™ toolkit with FPGA Hello World Face Detection Exercise</a> to learn more about how the software and hardware work together.</p>
<h2>Additional Resources</h2>
<p>Intel® Distribution of OpenVINO™ toolkit home page: <a href="https://software.intel.com/en-us/openvino-toolkit">https://software.intel.com/en-us/openvino-toolkit</a></p>
<p>Intel® Distribution of OpenVINO™ toolkit documentation: <a href="https://docs.openvinotoolkit.org/">https://docs.openvinotoolkit.org/</a></p>
<p>Inference Engine FPGA plugin documentation: <a href="https://docs.openvinotoolkit.org/latest/_docs_IE_DG_supported_plugins_FPGA.html">https://docs.openvinotoolkit.org/latest/_docs_IE_DG_supported_plugins_FPGA.html</a> </p>
</div></div><!-- contents -->
  <div class="footer">
  <div id="nav-path" class="navpath"></div>
  <div class="footer-content">
    <div class="footer-column">
      <h4>Support</h4>
      <ul>
        <li>
          <a href="https://software.intel.com/en-us/forums/computer-vision">Intel Developer Zone Forum for Intel Distribution of OpenVINO Toolkit</a></li>
      </ul>
    </div>
  </div>
  <div class="copyright">
    <p>Documentation for OpenVINO Toolkit.<br/>
    For more complete information about compiler optimizations, see our <a href="/<version_placeholder>/_docs_IE_DG_Optimization_notice.html">Optimization Notice</a></p>
  </div>
</div>
</body>
</html>