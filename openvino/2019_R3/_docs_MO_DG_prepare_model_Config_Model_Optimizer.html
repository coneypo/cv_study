<!DOCTYPE html>
<html lang="en">
<head>
<!-- HTML header for doxygen 1.8.12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Configuring the Model Optimizer - OpenVINO Toolkit</title>
<script type="text/javascript" src="jquery.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="dynsections.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../assets/versions_raw.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="../assets/openvino-versions.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="openvino-layout.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectalign">
   <div id="projectname"><a href="<domain_placeholder>" class="homelink-id">OpenVINO Toolkit</a></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js?v=e23bd1c8e92f867d90ca8af9d83669a3"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuring the Model Optimizer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>You must configure the Model Optimizer for the framework that was used to train the model. This section tells you how to configure the Model Optimizer either through scripts or by using a manual process.</p>
<h2>Using Configuration Scripts</h2>
<p>You can either configure all three frameworks at the same time or install an individual framework. The scripts delivered with the tool install all required dependencies and provide the fastest and easiest way to configure the Model Optimizer.</p>
<p>To configure all three frameworks, go to the <code>&lt;INSTALL_DIR&gt;/deployment_tools/model_optimizer/install_prerequisites</code> directory and run:</p>
<ul>
<li>For Linux* OS: <div class="fragment"><div class="line">install_prerequisites.sh</div></div><!-- fragment --> <blockquote class="doxtable">
<p><b>NOTE</b>: This command installs prerequisites globally. If you want to keep Model Optimizer in a separate sandbox, run the following commands instead: </p>
</blockquote>
<div class="fragment"><div class="line">virtualenv --system-site-packages -p python3 ./venv</div></div><!-- fragment --> <div class="fragment"><div class="line">source ./venv/bin/activate  # sh, bash, ksh, or zsh</div></div><!-- fragment --> <div class="fragment"><div class="line">./install_prerequisites.sh</div></div><!-- fragment --></li>
<li>For Windows* OS: <div class="fragment"><div class="line">install_prerequisites.bat</div></div><!-- fragment --></li>
</ul>
<p>To configure a specific framework, go to the <code>&lt;INSTALL_DIR&gt;/deployment_tools/model_optimizer/install_prerequisites</code> directory and run:</p>
<ul>
<li>For Caffe* on Linux: <div class="fragment"><div class="line">install_prerequisites_caffe.sh</div></div><!-- fragment --></li>
<li>For Caffe on Windows: <div class="fragment"><div class="line">install_prerequisites_caffe.bat</div></div><!-- fragment --></li>
<li>For TensorFlow* on Linux: <div class="fragment"><div class="line">install_prerequisites_tf.sh</div></div><!-- fragment --></li>
<li>For TensorFlow on Windows: <div class="fragment"><div class="line">install_prerequisites_tf.bat</div></div><!-- fragment --></li>
<li>For MXNet* on Linux: <div class="fragment"><div class="line">install_prerequisites_mxnet.sh</div></div><!-- fragment --></li>
<li>For MXNet on Windows: <div class="fragment"><div class="line">install_prerequisites_mxnet.bat</div></div><!-- fragment --></li>
<li>For Kaldi* on Linux: <div class="fragment"><div class="line">install_prerequisites_kaldi.sh</div></div><!-- fragment --></li>
<li>For Kaldi on Windows: <div class="fragment"><div class="line">install_prerequisites_kaldi.bat</div></div><!-- fragment --></li>
<li>For ONNX* on Linux: <div class="fragment"><div class="line">install_prerequisites_onnx.sh</div></div><!-- fragment --></li>
<li>For ONNX on Windows: <div class="fragment"><div class="line">install_prerequisites_onnx.bat</div></div><!-- fragment --></li>
</ul>
<blockquote class="doxtable">
<p><b>IMPORTANT</b>: <b>ONLY FOR CAFFE*</b> By default, you do not need to install Caffe to create an Intermediate Representation for a Caffe model, unless you use Caffe for custom layer shape inference and do not write Model Optimizer extensions. To learn more about implementing Model Optimizer custom operations and the limitations of using Caffe for shape inference, see <a class="el" href="_docs_MO_DG_prepare_model_customize_model_optimizer_Customize_Model_Optimizer.html">Custom Layers in Model Optimizer</a>. </p>
</blockquote>
<blockquote class="doxtable">
<p><b>IMPORTANT</b>: <b>ONLY FOR TENSORFLOW*</b> To <a class="el" href="_docs_MO_DG_prepare_model_customize_model_optimizer_Offloading_Sub_Graph_Inference.html">offload part of the inference to the TensorFlow framework</a>, additional configuration steps are required. </p>
</blockquote>
<h2>Using Manual Configuration Process</h2>
<p>If you prefer, you can manually configure the Model Optimizer for one framework at a time.</p>
<ol type="1">
<li>Go to the Model Optimizer directory: <div class="fragment"><div class="line">cd &lt;INSTALL_DIR&gt;/deployment_tools/model_optimizer/</div></div><!-- fragment --></li>
<li><b>Strongly recommended for all global Model Optimizer dependency installations</b>: Create and activate a virtual environment. While not required, this step is strongly recommended since the virtual environment creates a Python* sandbox, and dependencies for the Model Optimizer do not influence the global Python configuration, installed libraries, or other components. In addition, a flag ensures that system-wide Python libraries are available in this sandbox. Skip this step only if you do want to install all the Model Optimizer dependencies globally:<ul>
<li>Create a virtual environment: <div class="fragment"><div class="line">virtualenv -p /usr/bin/python3.6 .env3 --system-site-packages</div></div><!-- fragment --></li>
<li>Activate the virtual environment: <div class="fragment"><div class="line">virtualenv -p /usr/bin/python3.6 .env3/bin/activate</div></div><!-- fragment --></li>
</ul>
</li>
<li>Install all dependencies or only the dependencies for a specific framework:<ul>
<li>To install dependencies for all frameworks: <div class="fragment"><div class="line">pip3 install -r requirements.txt</div></div><!-- fragment --></li>
<li>To install dependencies only for Caffe: <div class="fragment"><div class="line">pip3 install -r requirements_caffe.txt</div></div><!-- fragment --></li>
<li>To install dependencies only for TensorFlow: <div class="fragment"><div class="line">pip3 install -r requirements_tf.txt</div></div><!-- fragment --></li>
<li>To install dependencies only for MXNet: <div class="fragment"><div class="line">pip3 install -r requirements_mxnet.txt</div></div><!-- fragment --></li>
<li>To install dependencies only for Kaldi: <div class="fragment"><div class="line">pip3 install -r requirements_kaldi.txt</div></div><!-- fragment --></li>
<li>To install dependencies only for ONNX: <div class="fragment"><div class="line">pip3 install -r requirements_onnx.txt</div></div><!-- fragment --></li>
</ul>
</li>
</ol>
<h2>Using the protobuf Library in the Model Optimizer for Caffe*</h2>
<p>These procedures require:</p>
<ul>
<li>Access to GitHub and the ability to use git commands</li>
<li>Microsoft Visual Studio* 2013 for Win64*</li>
<li>C/C++</li>
</ul>
<p>Model Optimizer uses the protobuf library to load trained Caffe models. By default, the library executes pure Python* language implementation, which is slow. These steps show how to use the faster C++ implementation of the protobuf library on Windows OS or Linux OS.</p>
<h3>Using the protobuf Library on Linux* OS</h3>
<p>To use the C++ implementation of the protobuf library on Linux, it is enough to set up the environment variable: </p><div class="fragment"><div class="line">export PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=cpp</div></div><!-- fragment --><h3><a class="anchor" id="protobuf-install-windows"></a>Using the protobuf Library on Windows* OS</h3>
<p>On Windows, pre-built protobuf packages for Python versions 3.4, 3.5, 3.6, and 3.7 are provided with the installation package and can be found in the <code>&lt;INSTALL_DIR&gt;\deployment_tools\model_optimizer\install_prerequisites</code> folder. Please note that they are not installed with the <code>install_prerequisites.bat</code> installation script due to possible issues with <code>pip</code>, and you can install them at your own discretion. Make sure that you install the protobuf version that matches the Python version you use:</p>
<ul>
<li><code>protobuf-3.6.1-py3.4-win-amd64.egg</code> for Python 3.4</li>
<li><code>protobuf-3.6.1-py3.5-win-amd64.egg</code> for Python 3.5</li>
<li><code>protobuf-3.6.1-py3.6-win-amd64.egg</code> for Python 3.6</li>
<li><code>protobuf-3.6.1-py3.7-win-amd64.egg</code> for Python 3.7</li>
</ul>
<p>To install the protobuf package:</p>
<ol type="1">
<li>Open the command prompt as administrator.</li>
<li>Go to the <code>install_prerequisites</code> folder of the OpenVINO toolkit installation directory: <div class="fragment"><div class="line">cd &lt;INSTALL_DIR&gt;\deployment_tools\model_optimizer\install_prerequisites</div></div><!-- fragment --></li>
<li>Run the following command to install the protobuf for Python 3.6. If you want to install the protobuf for Python 3.4, 3.5, or 3.7, replace <code>protobuf-3.6.1-py3.6-win-amd64.egg</code> with the corresponding file name from the list above. <div class="fragment"><div class="line">python -m easy_install protobuf-3.6.1-py3.6-win-amd64.egg</div></div><!-- fragment --> If the Python version you use is lower than 3.4, you need to update it or <a href="#build-protobuf">build the library manually</a>.</li>
</ol>
<h4><a class="anchor" id="build-protobuf"></a>Building the protobuf Library on Windows* OS</h4>
<blockquote class="doxtable">
<p><b>NOTE</b>: These steps are optional. If you use Python version 3.4, 3.5, 3.6, or 3.7, you can <a href="#protobuf-install-windows">install the protobuf library</a> using the pre-built packages. </p>
</blockquote>
<p>To compile the protobuf library from sources on Windows OS, do the following:</p>
<ol type="1">
<li>Clone protobuf source files from GitHub: <div class="fragment"><div class="line">git clone https://github.com/google/protobuf.git</div><div class="line">cd protobuf</div></div><!-- fragment --></li>
<li>Create a Visual Studio solution file. Run these commands: <div class="fragment"><div class="line">cd C:\Path\to\protobuf\cmake\build</div><div class="line">mkdir solution</div><div class="line">cd solution C:\Path\to\protobuf\cmake\build\solution</div><div class="line">cmake -G &quot;Visual Studio 12 2013 Win64&quot; ../..</div></div><!-- fragment --></li>
<li>Change the runtime library option for <code>libprotobuf</code> and <code>libprotobuf-lite</code>:<ul>
<li>Open the project's <b>Property Pages</b> dialog box</li>
<li>Expand the <b>C/C++** tab</b></li>
<li><b> Select the **Code Generation</b> property page</li>
<li>Change the <b>Runtime Library</b> property to <b>Multi-thread DLL (/MD)</b></li>
</ul>
</li>
<li>Build the <code>libprotoc</code>, <code>protoc</code>, <code>libprotobuf</code>, and <code>libprotobuf-lite</code> projects in the <b>Release</b> configuration.</li>
<li>Add a path to the build directory to the <code>PATH</code> environment variable: <div class="fragment"><div class="line">set PATH=%PATH%;C:\Path\to\protobuf\cmake\build\solution\Release</div></div><!-- fragment --></li>
<li>Go to the <code>python</code> directory: <div class="fragment"><div class="line">cd C:\Path\to\protobuf\python</div></div><!-- fragment --></li>
<li>Use a text editor to open and change these <code>setup.py</code> options:<ul>
<li>Change from <code>​libraries = ['protobuf']</code> to <code>libraries = ['libprotobuf', 'libprotobuf-lite']</code></li>
<li>Change from <code>extra_objects = ['../src/.libs/libprotobuf.a', '../src/.libs/libprotobuf-lite.a']</code> to <code>extra_objects = ['../cmake/build/solution/Release/libprotobuf.lib', '../cmake/build/solution/Release/libprotobuf-lite.lib']</code></li>
</ul>
</li>
<li>Build the Python package with the C++ implementation: <div class="fragment"><div class="line">python setup.py build –cpp_implementation</div></div><!-- fragment --></li>
<li>Install the Python package with the C++ implementation: <div class="fragment"><div class="line">python3 -m easy_install dist/protobuf-3.6.1-py3.6-win-amd64.egg</div></div><!-- fragment --></li>
<li>Set an environment variable to boost the protobuf performance: <div class="fragment"><div class="line">set PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=cpp</div></div><!-- fragment --></li>
</ol>
<h2>See Also</h2>
<ul>
<li><a class="el" href="_docs_MO_DG_prepare_model_convert_model_Converting_Model.html">Converting a Model to Intermediate Representation (IR)</a> </li>
</ul>
</div></div><!-- contents -->
  <div class="footer">
  <div id="nav-path" class="navpath"></div>
  <div class="footer-content">
    <div class="footer-column">
      <h4>Support</h4>
      <ul>
        <li>
          <a href="https://software.intel.com/en-us/forums/computer-vision">Intel Developer Zone Forum for Intel Distribution of OpenVINO Toolkit</a></li>
      </ul>
    </div>
  </div>
  <div class="copyright">
    <p>Documentation for OpenVINO Toolkit.<br/>
    For more complete information about compiler optimizations, see our <a href="/<version_placeholder>/_docs_IE_DG_Optimization_notice.html">Optimization Notice</a></p>
  </div>
</div>
</body>
</html>