<!DOCTYPE html>
<html lang="en">
<head>
<!-- HTML header for doxygen 1.8.12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Converting a Kaldi* Model - OpenVINO Toolkit</title>
<script type="text/javascript" src="jquery.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="dynsections.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../assets/versions_raw.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="../assets/openvino-versions.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="openvino-layout.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectalign">
   <div id="projectname"><a href="<domain_placeholder>" class="homelink-id">OpenVINO Toolkit</a></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js?v=e23bd1c8e92f867d90ca8af9d83669a3"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Converting a Kaldi* Model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A summary of the steps for optimizing and deploying a model that was trained with Kaldi*:</p>
<ol type="1">
<li><a class="el" href="_docs_MO_DG_prepare_model_Config_Model_Optimizer.html">Configure the Model Optimizer</a> for Kaldi*.</li>
<li><a href="#Convert_From_Kaldi">Convert a Kaldi* Model</a> to produce an optimized <a class="el" href="_docs_MO_DG_prepare_model_convert_model_IRLayersCatalogSpec.html">Intermediate Representation (IR)</a> of the model based on the trained network topology, weights, and biases values.</li>
<li>Test the model in the Intermediate Representation format using the <a class="el" href="_docs_IE_DG_Deep_Learning_Inference_Engine_DevGuide.html">Inference Engine</a> in the target environment via provided Inference Engine <a class="el" href="_docs_IE_DG_Samples_Overview.html">sample applications</a>.</li>
<li><a class="el" href="_docs_IE_DG_Samples_Overview.html">Integrate</a> the <a class="el" href="_docs_IE_DG_Deep_Learning_Inference_Engine_DevGuide.html">Inference Engine</a> in your application to deploy the model in the target environment.</li>
</ol>
<blockquote class="doxtable">
<p><b>NOTE:</b> The Model Optimizer supports the <a href="http://kaldi-asr.org/doc/dnn1.html">nnet1</a> and <a href="http://kaldi-asr.org/doc/dnn2.html">nnet2</a> formats of Kaldi models. Support of the <a href="http://kaldi-asr.org/doc/dnn3.html">nnet3</a> format is limited. </p>
</blockquote>
<h2>Supported Topologies</h2>
<ul>
<li>Convolutional Neural Networks (CNN):<ul>
<li>Wall Street Journal CNN (wsj_cnn4b)</li>
<li>Resource Management CNN (rm_cnn4a_smbr)</li>
</ul>
</li>
<li>Long Short Term Memory (LSTM) Networks:<ul>
<li>Resource Management LSTM (rm_lstm4f)</li>
<li>TED-LIUM LSTM (ted_lstm4f)</li>
</ul>
</li>
<li>Deep Neural Networks (DNN):<ul>
<li>Wall Street Journal DNN (wsj_dnn5b_smbr);</li>
<li>TED-LIUM DNN (ted_dnn_smbr)</li>
</ul>
</li>
<li>Time delay neural network (TDNN)<ul>
<li><a class="el" href="_docs_MO_DG_prepare_model_convert_model_kaldi_specific_Aspire_Tdnn_Model.html">ASpIRE Chain TDNN</a>;</li>
</ul>
</li>
<li>TDNN-LSTM model</li>
</ul>
<h2>Convert a Kaldi* Model <a class="anchor" id="Convert_From_Kaldi"></a></h2>
<p>To convert a Kaldi* model:</p>
<ol type="1">
<li>Go to the <code>&lt;INSTALL_DIR&gt;/deployment_tools/model_optimizer</code> directory.</li>
<li>Use the <code>mo.py</code> script to simply convert a model with the path to the input model <code>.nnet</code> or <code>.mdl</code> file: <div class="fragment"><div class="line">python3 mo.py --input_model &lt;INPUT_MODEL&gt;.nnet</div></div><!-- fragment --></li>
</ol>
<p>Two groups of parameters are available to convert your model:</p>
<ul>
<li><a class="el" href="_docs_MO_DG_prepare_model_convert_model_Converting_Model_General.html">Framework-agnostic parameters</a>: These parameters are used to convert any model trained in any supported framework.</li>
<li><a href="#kaldi_specific_conversion_params">Kaldi-specific parameters</a>: Parameters used to convert only Kaldi* models.</li>
</ul>
<h3>Using Kaldi*-Specific Conversion Parameters <a class="anchor" id="kaldi_specific_conversion_params"></a></h3>
<p>The following list provides the Kaldi*-specific parameters.</p>
<div class="fragment"><div class="line">Kaldi-specific parameters:</div><div class="line">  --counts COUNTS       A file name with full path to the counts file</div><div class="line">  --remove_output_softmax</div><div class="line">                        Removes the Softmax that is the output layer</div><div class="line">  --remove_memory       Remove the Memory layer and add new inputs and outputs instead</div></div><!-- fragment --><h3>Examples of CLI Commands</h3>
<ul>
<li>To launch the Model Optimizer for the wsj_dnn5b_smbr model with the specified <code>.nnet</code> file: <div class="fragment"><div class="line">python3 mo.py --input_model wsj_dnn5b_smbr.nnet</div></div><!-- fragment --></li>
<li>To launch the Model Optimizer for the wsj_dnn5b_smbr model with existing file that contains counts for the last layer with biases: <div class="fragment"><div class="line">python3 mo.py --input_model wsj_dnn5b_smbr.nnet --counts wsj_dnn5b_smbr.counts</div></div><!-- fragment --><ul>
<li>The Model Optimizer normalizes сounts in the following way: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ S = \frac{1}{\sum_{j = 0}^{|C|}C_{j}} \]" src="form_0.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ C_{i}=log(S*C_{i}) \]" src="form_1.png"/>
</p>
 where <img class="formulaInl" alt="$C$" src="form_2.png"/> - the counts array, <img class="formulaInl" alt="$C_{i} - i^{th}$" src="form_3.png"/> element of the counts array, <img class="formulaInl" alt="$|C|$" src="form_4.png"/> - number of elements in the counts array;</li>
<li>The normalized counts are subtracted from biases of the last or next to last layer (if last layer is SoftMax).</li>
</ul>
</li>
<li>If you want to remove the last SoftMax layer in the topology, launch the Model Optimizer with the <code>--remove_output_softmax</code> flag. <div class="fragment"><div class="line">python3 mo.py --input_model wsj_dnn5b_smbr.nnet --counts wsj_dnn5b_smbr.counts --remove_output_softmax</div></div><!-- fragment --> The Model Optimizer finds the last layer of the topology and removes this layer only if it is a SoftMax layer.</li>
</ul>
<blockquote class="doxtable">
<p><b>NOTE:</b> Model Optimizer can remove SoftMax layer only if the topology has one output. </p>
</blockquote>
<blockquote class="doxtable">
<p><b>NOTE:</b> For sample inference of Kaldi models, you can use the Inference Engine Speech Recognition sample application. The sample supports models with one output. If your model has several outputs, specify the desired one with the <code>--output</code> option. </p>
</blockquote>
<p>If you want to convert a model for inference on Intel® Movidius™ Myriad™, use the <code>--remove_memory</code> option. It removes Memory layers from the IR. Instead of it, additional inputs and outputs appear in the IR. The Model Optimizer outputs the mapping between inputs and outputs. For example: </p><div class="fragment"><div class="line">[ WARNING ]  Add input/output mapped Parameter_0_for_Offset_fastlstm2.r_trunc__2Offset_fastlstm2.r_trunc__2_out -&gt; Result_for_Offset_fastlstm2.r_trunc__2Offset_fastlstm2.r_trunc__2_out </div><div class="line">[ WARNING ]  Add input/output mapped Parameter_1_for_Offset_fastlstm2.r_trunc__2Offset_fastlstm2.r_trunc__2_out -&gt; Result_for_Offset_fastlstm2.r_trunc__2Offset_fastlstm2.r_trunc__2_out </div><div class="line">[ WARNING ]  Add input/output mapped Parameter_0_for_iteration_Offset_fastlstm3.c_trunc__3390 -&gt; Result_for_iteration_Offset_fastlstm3.c_trunc__3390 </div></div><!-- fragment --><p> Based on this mapping, link inputs and outputs in your application manually as follows:</p>
<ol type="1">
<li>Initialize inputs from the mapping as zeros in the first frame of an utterance.</li>
<li>Copy output blobs from the mapping to the corresponding inputs. For example, data from <code>Result_for_Offset_fastlstm2.r_trunc__2Offset_fastlstm2.r_trunc__2_out</code> must be copied to <code>Parameter_0_for_Offset_fastlstm2.r_trunc__2Offset_fastlstm2.r_trunc__2_out</code>.</li>
</ol>
<h2>Supported Kaldi* Layers</h2>
<p>Refer to <a class="el" href="_docs_MO_DG_prepare_model_Supported_Frameworks_Layers.html">Supported Framework Layers </a> for the list of supported standard layers. </p>
</div></div><!-- contents -->
  <div class="footer">
  <div id="nav-path" class="navpath"></div>
  <div class="footer-content">
    <div class="footer-column">
      <h4>Support</h4>
      <ul>
        <li>
          <a href="https://software.intel.com/en-us/forums/computer-vision">Intel Developer Zone Forum for Intel Distribution of OpenVINO Toolkit</a></li>
      </ul>
    </div>
  </div>
  <div class="copyright">
    <p>Documentation for OpenVINO Toolkit.<br/>
    For more complete information about compiler optimizations, see our <a href="/<version_placeholder>/_docs_IE_DG_Optimization_notice.html">Optimization Notice</a></p>
  </div>
</div>
</body>
</html>