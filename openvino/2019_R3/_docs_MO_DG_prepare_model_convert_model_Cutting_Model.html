<!DOCTYPE html>
<html lang="en">
<head>
<!-- HTML header for doxygen 1.8.12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cutting Off Parts of a Model - OpenVINO Toolkit</title>
<script type="text/javascript" src="jquery.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="dynsections.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../assets/versions_raw.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="../assets/openvino-versions.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
<script type="text/javascript" src="openvino-layout.js?v=061b82a77ebb139b894ce81faa5ba1f6"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectalign">
   <div id="projectname"><a href="<domain_placeholder>" class="homelink-id">OpenVINO Toolkit</a></div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js?v=e23bd1c8e92f867d90ca8af9d83669a3"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Cutting Off Parts of a Model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sometimes some parts of a model must be removed while the Model Optimizer is converting models to the Intermediate Representation. This chapter describes methods of doing cutting off parts of a model using Model Optimizer command-line options. Model cutting applies mostly to TensorFlow* models, but is also useful for other frameworks. In this chapter, TensorFlow examples are used for illustration.</p>
<h2>Purpose of Model Cutting</h2>
<p>The following examples are the situations when model cutting is useful or even required:</p>
<ul>
<li>model has pre- or post-processing parts that cannot be translated to existing Inference Engine layers.</li>
<li>model has a training part that is convenient to be kept in the model, but not used during inference.</li>
<li>model is too complex (contains lots of unsupported operations that cannot be easily implemented as custom layers), so the complete model cannot be converted in one shot.</li>
<li>model is one of the supported <a class="el" href="_docs_MO_DG_prepare_model_customize_model_optimizer_TensorFlow_SSD_ObjectDetection_API.html">SSD models</a>. In this case, you need to cut a post-processing part off.</li>
<li>problem with model conversion in the Model Optimizer or inference in the Inference Engine occurred. To localize the issue, limit the scope for conversion by iteratively searching for problematic places in the model.</li>
<li>single custom layer or a combination of custom layers is isolated for debugging purposes.</li>
</ul>
<h2>Command-Line Options</h2>
<p>Model Optimizer provides command line options <code>--input</code> and <code>--output</code> to specify new entry and exit nodes, while ignoring the rest of the model:</p>
<ul>
<li><code>--input</code> option accepts a comma-separated list of layer names of the input model that should be treated as new entry points to the model.</li>
<li><code>--output</code> option accepts a comma-separated list of layer names of the input model that should be treated as new exit points from the model.</li>
</ul>
<p>The <code>--input</code> option is required for cases unrelated to model cutting. For example, when the model contains several inputs and <code>--input_shape</code> or <code>--mean_values</code> options are used, you should use the <code>--input</code> option to specify the order of input nodes for correct mapping between multiple items provided in <code>--input_shape</code> and <code>--mean_values</code> and the inputs in the model. This is out of scope.</p>
<p>Model cutting is illustrated with Inception V1. This model is in <code>models/research/slim</code> repository. <a class="el" href="_docs_MO_DG_prepare_model_convert_model_Converting_Model.html">This section</a> describes pre-work to prepare the model for the Model Optimizer to be ready to proceed with this chapter.</p>
<h2>Default Behavior without &ndash;input and &ndash;output</h2>
<p>The input model is converted as a whole if neither <code>--input</code> nor <code>--output</code> command line options are used. All <code>Placeholder</code> operations in a TensorFlow* graph are automatically identified as entry points. The <code>Input</code> layer type is generated for each of them. All nodes that have no consumers are automatically identified as exit points.</p>
<p>For Inception_V1, there is one <code>Placeholder</code>: input. If the model is viewed in the TensorBoard*, the input operation is easy to find:</p>
<div class="image">
<img src="inception_v1_std_input.png" alt="inception_v1_std_input.png"/>
<div class="caption">
Placeholder in Inception V1</div></div>
<p> There is only one output operation, which enclosed in a nested name scope <code>InceptionV1/Logits/Predictions</code>, the <code>Reshape</code> operation has a full name <code>InceptionV1/Logits/Predictions/Reshape_1</code>.</p>
<p>In the TensorBoard, it looks the following way together with some predecessors:</p>
<div class="image">
<img src="inception_v1_std_output.png" alt="inception_v1_std_output.png"/>
<div class="caption">
TensorBoard with predecessors</div></div>
<p> Convert this model: </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1</div></div><!-- fragment --><p> The output <code>.xml</code> file with an Intermediate Representation contains the <code>Input</code> layer among other layers in the model: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;286&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;input&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;3&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;224&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;224&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">layer</span>&gt;</div></div><!-- fragment --><p> The <code>input</code> layer is converted from the TensorFlow graph <code>Placeholder</code> operation <code>input</code> and has the same name.</p>
<p>The <code>-b</code> option is used here for conversion to override a possible undefined batch size (coded as -1 in TensorFlow models). If a model was frozen with a defined batch size, you may omit this option in all the examples.</p>
<p>The last layer in the model is <code>InceptionV1/Logits/Predictions/Reshape_1</code>, which matches an output operation in the TensorFlow graph: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;389&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/Logits/Predictions/Reshape_1&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Reshape&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">data</span> <span class="keyword">axis</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">dim</span>=<span class="stringliteral">&quot;1,1001&quot;</span> <span class="keyword">num_axes</span>=<span class="stringliteral">&quot;-1&quot;</span>/&gt;</div><div class="line">    &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1001&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1001&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">layer</span>&gt;</div></div><!-- fragment --><p> Due to automatic identification of inputs and outputs, you do not need to provide the <code>--input</code> and <code>--output</code> options to convert the whole model. The following commands are equivalent for the Inception V1 model: </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1</div><div class="line"></div><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --input=input --output=InceptionV1/Logits/Predictions/Reshape_1</div></div><!-- fragment --><p> The Intermediate Representations are identical for both conversions. The same is true if the model has multiple inputs and/or outputs.</p>
<h2>Model Cutting</h2>
<p>Now consider how to cut some parts of the model off. This chapter uses the first convolution block <code>InceptionV1/InceptionV1/Conv2d_1a_7x7</code> of the Inception V1 model to illustrate cutting:</p>
<div class="image">
<img src="inception_v1_first_block.png" alt="inception_v1_first_block.png"/>
<div class="caption">
Inception V1 first convolution block</div></div>
 <h3>Cutting at the End</h3>
<p>If you want to cut your model at the end, you have the following options:</p>
<ol type="1">
<li>The following command cuts off the rest of the model after the <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code>, making this node the last in the model: <div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --output=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</div></div><!-- fragment --> The resulting Intermediate Representation has three layers: <div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> ?&gt;</div><div class="line">&lt;<span class="keywordtype">net</span> <span class="keyword">batch</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;model&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;2&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">layers</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;input&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Convolution&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">data</span> <span class="keyword">dilation-x</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">dilation-y</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">group</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">kernel-x</span>=<span class="stringliteral">&quot;7&quot;</span> <span class="keyword">kernel-y</span>=<span class="stringliteral">&quot;7&quot;</span> <span class="keyword">output</span>=<span class="stringliteral">&quot;64&quot;</span> <span class="keyword">pad-x</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">pad-y</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">stride</span>=<span class="stringliteral">&quot;1,1,2,2&quot;</span> <span class="keyword">stride-x</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">stride-y</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">blobs</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">weights</span> <span class="keyword">offset</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">size</span>=<span class="stringliteral">&quot;37632&quot;</span>/&gt;</div><div class="line">                &lt;<span class="keywordtype">biases</span> <span class="keyword">offset</span>=<span class="stringliteral">&quot;37632&quot;</span> <span class="keyword">size</span>=<span class="stringliteral">&quot;256&quot;</span>/&gt;</div><div class="line">            &lt;/<span class="keywordtype">blobs</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;6&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ReLU&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">layers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">edges</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;6&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">edges</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">net</span>&gt;</div></div><!-- fragment --> As you can see in the TensorBoard picture, the original model has more nodes than Intermediate Representation. Model Optimizer has fused batch normalization <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/BatchNorm</code> to the convolution <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution</code>, and it is not present in the final Intermediate Representation. This is not an effect of the <code>--output</code> option, it is usual behavior of the Model Optimizer for batch normalizations and convolutions. The effect of the <code>--output</code> is that the <code>ReLU</code> layer becomes the last one in the converted model.</li>
<li>The following command cuts the edge that comes from 0 output port of the <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code> and the rest of the model, making this node the last one in the model: <div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --output=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu:0</div></div><!-- fragment --> The resulting Intermediate Representation has three layers, which are the same as in the previous case: <div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> ?&gt;</div><div class="line">&lt;<span class="keywordtype">net</span> <span class="keyword">batch</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;model&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;2&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">layers</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;input&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Convolution&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">data</span> <span class="keyword">dilation-x</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">dilation-y</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">group</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">kernel-x</span>=<span class="stringliteral">&quot;7&quot;</span> <span class="keyword">kernel-y</span>=<span class="stringliteral">&quot;7&quot;</span> <span class="keyword">output</span>=<span class="stringliteral">&quot;64&quot;</span> <span class="keyword">pad-x</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">pad-y</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">stride</span>=<span class="stringliteral">&quot;1,1,2,2&quot;</span> <span class="keyword">stride-x</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">stride-y</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">blobs</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">weights</span> <span class="keyword">offset</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">size</span>=<span class="stringliteral">&quot;37632&quot;</span>/&gt;</div><div class="line">                &lt;<span class="keywordtype">biases</span> <span class="keyword">offset</span>=<span class="stringliteral">&quot;37632&quot;</span> <span class="keyword">size</span>=<span class="stringliteral">&quot;256&quot;</span>/&gt;</div><div class="line">            &lt;/<span class="keywordtype">blobs</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;6&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ReLU&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">layers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">edges</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;6&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">edges</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">net</span>&gt;</div></div><!-- fragment --> This type of cutting is useful to cut edges in case of multiple output edges.</li>
<li>The following command cuts the edge that comes to 0 input port of the <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code> and the rest of the model including <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code>, deleting this node and making the previous node <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Conv2D</code> the last in the model: <div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --output=0:InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</div></div><!-- fragment --> The resulting Intermediate Representation has two layers, which are the same as the first two layers in the previous case: <div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> ?&gt;</div><div class="line">&lt;<span class="keywordtype">net</span> <span class="keyword">batch</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;inception_v1&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;2&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">layers</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;input&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Conv2D&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Convolution&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">data</span> <span class="keyword">auto_pad</span>=<span class="stringliteral">&quot;same_upper&quot;</span> <span class="keyword">dilation-x</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">dilation-y</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">group</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">kernel-x</span>=<span class="stringliteral">&quot;7&quot;</span> <span class="keyword">kernel-y</span>=<span class="stringliteral">&quot;7&quot;</span> <span class="keyword">output</span>=<span class="stringliteral">&quot;64&quot;</span> <span class="keyword">pad-b</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">pad-r</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">pad-x</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">pad-y</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">stride</span>=<span class="stringliteral">&quot;1,1,2,2&quot;</span> <span class="keyword">stride-x</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">stride-y</span>=<span class="stringliteral">&quot;2&quot;</span>/&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">blobs</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">weights</span> <span class="keyword">offset</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">size</span>=<span class="stringliteral">&quot;37632&quot;</span>/&gt;</div><div class="line">                &lt;<span class="keywordtype">biases</span> <span class="keyword">offset</span>=<span class="stringliteral">&quot;37632&quot;</span> <span class="keyword">size</span>=<span class="stringliteral">&quot;256&quot;</span>/&gt;</div><div class="line">            &lt;/<span class="keywordtype">blobs</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">layers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">edges</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">edges</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">net</span>&gt;</div></div><!-- fragment --></li>
</ol>
<h3>Cutting from the Beginning</h3>
<p>If you want to go further and cut the beginning of the model, leaving only the <code>ReLU</code> layer, you have the following options:</p>
<ol type="1">
<li><p class="startli">You can use the following command line, where <code>--input</code> and <code>--output</code> specify the same node in the graph: </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --output=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu --input=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</div></div><!-- fragment --><p> The resulting Intermediate Representation looks as follows: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>&gt;</div><div class="line">&lt;<span class="keywordtype">net</span> <span class="keyword">batch</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;model&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;2&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">layers</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu/placeholder_port_0&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ReLU&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">layers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">edges</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">edges</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">net</span>&gt;</div></div><!-- fragment --><p> <code>Input</code> layer is automatically created to feed the layer that is converted from the node specified in <code>--input</code>, which is <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code> in this case. Model Optimizer does not replace the <code>ReLU</code> node by the <code>Input</code> layer, it produces such Intermediate Representation to make the node be the first executable node in the final Intermediate Representation. So the Model Optimizer creates enough <code>Inputs</code> to feed all input ports of the node that is passed in <code>--input</code>.</p>
<p class="startli">Even though <code>--input_shape</code> is not specified in the command line, the shapes for layers are inferred from the beginning of the original TensorFlow* model to the point at which the new input is defined. It has the same shape [1,64,112,112] as the model converted as a whole or without cutting off the beginning.</p>
</li>
<li><p class="startli">You can cut edge incoming to layer by port number. To specify incoming port use notation <code>--input=port:input_node</code>. So, to cut everything before <code>ReLU</code> layer, cut edge incoming in port 0 of <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code> node: </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --input=0:InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu --output=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</div></div><!-- fragment --><p> The resulting Intermediate Representation looks as follows: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>&gt;</div><div class="line">&lt;<span class="keywordtype">net</span> <span class="keyword">batch</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;model&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;2&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">layers</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu/placeholder_port_0&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ReLU&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">layers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">edges</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">edges</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">net</span>&gt;</div></div><!-- fragment --><p> <code>Input</code> layer is automatically created to feed the layer that is converted from the node specified in <code>--input</code>, which is <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</code> in this case. Model Optimizer does not replace the <code>ReLU</code> node by the <code>Input</code> layer, it produces such Intermediate Representation to make the node be the first executable node in the final Intermediate Representation. So the Model Optimizer creates enough <code>Inputs</code> to feed all input ports of the node that is passed in <code>--input</code>.</p>
<p class="startli">Even though <code>--input_shape</code> is not specified in the command line, the shapes for layers are inferred from the beginning of the original TensorFlow* model to the point at which the new input is defined. It has the same shape [1,64,112,112] as the model converted as a whole or without cutting off the beginning.</p>
</li>
<li>You can cut edge outcoming from layer by port number. To specify outcoming port use notation <code>--input=input_node:port</code>. So, to cut everything before <code>ReLU</code> layer, cut edge from <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/BatchNorm/batchnorm/add_1</code> node to <code>ReLU</code>: <div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --input=InceptionV1/InceptionV1/Conv2d_1a_7x7/BatchNorm/batchnorm/add_1:0 --output=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</div></div><!-- fragment --> The resulting Intermediate Representation looks as follows: <div class="fragment"><div class="line">&lt;<span class="keywordtype">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>&gt;</div><div class="line">&lt;<span class="keywordtype">net</span> <span class="keyword">batch</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;model&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;2&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">layers</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/BatchNorm/batchnorm/add_1/placeholder_out_port_0&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ReLU&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">                &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;...&lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">            &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">layers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">edges</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">edge</span> <span class="keyword">from-layer</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">from-port</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">to-layer</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">to-port</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div><div class="line">    &lt;/<span class="keywordtype">edges</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">net</span>&gt;</div></div><!-- fragment --></li>
</ol>
<h2>Shape Override for New Inputs</h2>
<p>The input shape can be overridden with <code>--input_shape</code>. In this case, the shape is applied to the node referenced in <code>--input</code>, not to the original <code>Placeholder</code> in the model. For example, this command line </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb --input_shape=[1,5,10,20] --output=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu --input=InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu</div></div><!-- fragment --><p>gives the following shapes in the <code>Input</code> and <code>ReLU</code> layers:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu/placeholder_port_0&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Input&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;20&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;5&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;10&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">layer</span>&gt;</div><div class="line">&lt;<span class="keywordtype">layer</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;3&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;InceptionV1/InceptionV1/Conv2d_1a_7x7/Relu&quot;</span> <span class="keyword">precision</span>=<span class="stringliteral">&quot;FP32&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ReLU&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">input</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;20&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;5&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;10&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">input</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">output</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">port</span> <span class="keyword">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;1&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;20&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;5&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">            &lt;<span class="keywordtype">dim</span>&gt;10&lt;/<span class="keywordtype">dim</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">port</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">output</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">layer</span>&gt;</div></div><!-- fragment --><p> An input shape [1,20,5,10] in the final Intermediate Representation differs from the shape [1,5,10,20] specified in the command line, because the original TensorFlow* model uses NHWC layout, but the Intermediate Representation uses NCHW layout. So usual NHWC to NCHW layout conversion occurred.</p>
<p>When <code>--input_shape</code> is specified, shape inference inside the Model Optimizer is not performed for the nodes in the beginning of the model that are not included in the translated region. It differs from the case when <code>--input_shape</code> is not specified as noted in the previous section where the shape inference is still performed for such nodes to deduce shape for the layers that should fall into the final Intermediate Representation. So <code>--input_shape</code> should be used for a model with a complex graph with loops, which are not supported by the Model Optimizer, to exclude such parts from the Model Optimizer shape inference process completely.</p>
<h2>Inputs with Multiple Input Ports</h2>
<p>There are operations that contain more than one input ports. In the example considered here, the convolution <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution</code> is such operation. When <code>--input_shape</code> is not provided, a new <code>Input</code> layer is created for each dynamic input port for the node. If a port is evaluated to a constant blob, this constant remains in the model and a corresponding input layer is not created. TensorFlow convolution used in this model contains two ports:</p>
<ul>
<li>port 0: input tensor for convolution (dynamic)</li>
<li>port 1: convolution weights (constant)</li>
</ul>
<p>Following this behavior, the Model Optimizer creates an <code>Input</code> layer for port 0 only, leaving port 1 as a constant. So the result of:</p>
<div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb -b 1 --input=InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution</div></div><!-- fragment --><p>is identical to the result of conversion of the model as a whole, because this convolution is the first executable operation in Inception V1.</p>
<p>Different behavior occurs when <code>--input_shape</code> is also used as an attempt to override the input shape: </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb--input=InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution --input_shape=[1,224,224,3]</div></div><!-- fragment --><p> An error occurs (for more information, see <a href="MO_FAQ.html#FAQ30">FAQ #30</a>): </p><div class="fragment"><div class="line">[ ERROR ]  Node InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution has more than 1 input and input shapes were provided.</div><div class="line">Try not to provide input shapes or specify input port with PORT:NODE notation, where PORT is an integer.</div><div class="line">For more information, see FAQ #30</div></div><!-- fragment --><p> In this case, when <code>--input_shape</code> is specified and the node contains multiple input ports, you need to specify an input port index together with an input node name. The input port index is specified in front of the node name with ':' as a separator (<code>PORT:NODE</code>). In the considered case, the port index 0 of the node <code>InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution</code> should be specified as <code>0:InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution</code>.</p>
<p>The correct command line is: </p><div class="fragment"><div class="line">python3 mo.py --input_model=inception_v1.pb --input=0:InceptionV1/InceptionV1/Conv2d_1a_7x7/convolution --input_shape=[1,224,224,3]</div></div><!-- fragment --> </div></div><!-- contents -->
  <div class="footer">
  <div id="nav-path" class="navpath"></div>
  <div class="footer-content">
    <div class="footer-column">
      <h4>Support</h4>
      <ul>
        <li>
          <a href="https://software.intel.com/en-us/forums/computer-vision">Intel Developer Zone Forum for Intel Distribution of OpenVINO Toolkit</a></li>
      </ul>
    </div>
  </div>
  <div class="copyright">
    <p>Documentation for OpenVINO Toolkit.<br/>
    For more complete information about compiler optimizations, see our <a href="/<version_placeholder>/_docs_IE_DG_Optimization_notice.html">Optimization Notice</a></p>
  </div>
</div>
</body>
</html>